<template>
  <footer class="footer">
    <div class="container">
      <div class="footer__logo">
        <svg
          width="186"
          height="47"
          viewBox="0 0 186 47"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1.66272 0H1.00529L1.37236 0.545415L16.324 22.7621L0.387049 45.4558L0 46.007H0.673476H14.6466H14.8419L14.9444 45.8408L23.8145 31.4696L32.413 43.8405L32.5174 43.9907H32.7004H46.6735H47.3719L46.9539 43.4312L31.1592 22.2924L45.9641 2.57644L46.3847 2.01628H45.6842H32.5767H32.3973L32.2926 2.16188L24.0652 13.5986L15.6855 0.164763L15.5827 0H15.3885H1.66272ZM17.0391 22.5709L2.32015 0.7H15.1943L23.7475 14.412L24.0237 14.8549L24.3286 14.4311L32.7561 2.71628H44.9837L30.442 22.0817L30.2846 22.2913L30.4415 22.5014L45.9751 43.2907H32.8833L24.0845 30.6316L23.7798 30.1932L23.4993 30.6476L14.4513 45.307H1.34695L17.0352 22.9674L17.1735 22.7705L17.0391 22.5709ZM56.3935 21.63V15.47H70.4335V9.35H48.4735V37.35H56.3935V27.75H68.7535V21.63H56.3935ZM96.6175 37.35V31.23H81.9775V26.11H94.4175V20.19H81.9775V15.47H96.0975V9.35H74.1375V37.35H96.6175ZM127.653 37.35V9.35H119.893V24.27L107.533 9.35H101.013V37.35H108.773V22.43L121.133 37.35H127.653ZM139.279 36.07C141.626 37.2967 144.266 37.91 147.199 37.91C149.759 37.91 152.066 37.4567 154.119 36.55C156.172 35.6433 157.879 34.3367 159.239 32.63L154.199 28.07C152.386 30.2567 150.186 31.35 147.599 31.35C146.079 31.35 144.719 31.0167 143.519 30.35C142.346 29.6833 141.426 28.75 140.759 27.55C140.119 26.3233 139.799 24.9233 139.799 23.35C139.799 21.7767 140.119 20.39 140.759 19.19C141.426 17.9633 142.346 17.0167 143.519 16.35C144.719 15.6833 146.079 15.35 147.599 15.35C150.186 15.35 152.386 16.4433 154.199 18.63L159.239 14.07C157.879 12.3633 156.172 11.0567 154.119 10.15C152.066 9.24333 149.759 8.79 147.199 8.79C144.266 8.79 141.626 9.41666 139.279 10.67C136.959 11.8967 135.132 13.6167 133.799 15.83C132.466 18.0433 131.799 20.55 131.799 23.35C131.799 26.15 132.466 28.6567 133.799 30.87C135.132 33.0833 136.959 34.8167 139.279 36.07ZM185.25 37.35V31.23H170.61V26.11H183.05V20.19H170.61V15.47H184.73V9.35H162.77V37.35H185.25Z"
            fill="#F7F7F7"
          />
        </svg>
      </div>
      <div class="footer__mini">
        <svg
          width="186"
          height="47"
          viewBox="0 0 186 47"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1.66272 0H1.00529L1.37236 0.545415L16.324 22.7621L0.387049 45.4558L0 46.007H0.673476H14.6466H14.8419L14.9444 45.8408L23.8145 31.4696L32.413 43.8405L32.5174 43.9907H32.7004H46.6735H47.3719L46.9539 43.4312L31.1592 22.2924L45.9641 2.57644L46.3847 2.01628H45.6842H32.5767H32.3973L32.2926 2.16188L24.0652 13.5986L15.6855 0.164763L15.5827 0H15.3885H1.66272ZM17.0391 22.5709L2.32015 0.7H15.1943L23.7475 14.412L24.0237 14.8549L24.3286 14.4311L32.7561 2.71628H44.9837L30.442 22.0817L30.2846 22.2913L30.4415 22.5014L45.9751 43.2907H32.8833L24.0845 30.6316L23.7798 30.1932L23.4993 30.6476L14.4513 45.307H1.34695L17.0352 22.9674L17.1735 22.7705L17.0391 22.5709ZM56.3935 21.63V15.47H70.4335V9.35H48.4735V37.35H56.3935V27.75H68.7535V21.63H56.3935ZM96.6175 37.35V31.23H81.9775V26.11H94.4175V20.19H81.9775V15.47H96.0975V9.35H74.1375V37.35H96.6175ZM127.653 37.35V9.35H119.893V24.27L107.533 9.35H101.013V37.35H108.773V22.43L121.133 37.35H127.653ZM139.279 36.07C141.626 37.2967 144.266 37.91 147.199 37.91C149.759 37.91 152.066 37.4567 154.119 36.55C156.172 35.6433 157.879 34.3367 159.239 32.63L154.199 28.07C152.386 30.2567 150.186 31.35 147.599 31.35C146.079 31.35 144.719 31.0167 143.519 30.35C142.346 29.6833 141.426 28.75 140.759 27.55C140.119 26.3233 139.799 24.9233 139.799 23.35C139.799 21.7767 140.119 20.39 140.759 19.19C141.426 17.9633 142.346 17.0167 143.519 16.35C144.719 15.6833 146.079 15.35 147.599 15.35C150.186 15.35 152.386 16.4433 154.199 18.63L159.239 14.07C157.879 12.3633 156.172 11.0567 154.119 10.15C152.066 9.24333 149.759 8.79 147.199 8.79C144.266 8.79 141.626 9.41666 139.279 10.67C136.959 11.8967 135.132 13.6167 133.799 15.83C132.466 18.0433 131.799 20.55 131.799 23.35C131.799 26.15 132.466 28.6567 133.799 30.87C135.132 33.0833 136.959 34.8167 139.279 36.07ZM185.25 37.35V31.23H170.61V26.11H183.05V20.19H170.61V15.47H184.73V9.35H162.77V37.35H185.25Z"
            fill="#F7F7F7"
          />
        </svg>
      </div>
    </div>
    <div class="footer__row">
      <div class="footer__column">
        <div class="footer__item item">
          <div class="item__title">
            <h1>Позвонить</h1>
          </div>
          <div class="item__text">
            <a href="tel:+7(383)375-00-28"><p>8 (383) 375-00-28</p></a>
          </div>
        </div>
        <div class="footer__item item">
          <div class="item__title">
            <h1>Контакты</h1>
          </div>
          <div class="item__text">
            <p>г. Новосибирск, ул. Бетонная 6</p>
            <a href="tel:+7(383)375-00-28"><p>8 (383) 375-00-28</p></a>
            <a href="mailto:xfenceru@gmail.com"><p>xfenceru@gmail.com</p></a>
          </div>
        </div>
      </div>
      <div class="footer__column">
        <div class="footer__info-title">
          <h1>Оставить заявку на обратный звонок</h1>
          <div class="footer__form">
            <!-- <form action=""> -->
            <form class="footer__form" id="myForm" @submit.prevent="postPosts">
              <span
                v-if="
                  ($v.namefooter.$dirty || $v.phonefooter.$dirty) &&
                    !$v.namefooter.required &&
                    !$v.phonefooter.required
                "
                class="span-error"
              >
                Пожалуйста, заполните все поля
              </span>

              <span
                v-else-if="$v.namefooter.$error || $v.phonefooter.$error"
                class="span-error"
              >
                Данные введены некорректно
              </span>
              <input
                type="text"
                id="namefooter"
                name="namefooter"
                class="input__footer"
                v-model.trim="$v.namefooter.$model"
                :class="{ 'error-valid': $v.namefooter.$error }"
                required
              />

              <label for="namefooter" class="validlab">Имя</label>

              <input
                type="text"
                id="phonefooter"
                name="phonefooter"
                class="input__footer"
                v-model.trim="$v.phonefooter.$model"
                v-phone
                :class="{ 'error-valid': $v.phonefooter.$error }"
                required
              />

              <label for="phonefooter" class="validlab">Номер телефона</label>

              <div class="footer-btn">
                <button class="button" type="submit" :disabled="$v.$invalid">
                  Позвоните мне
                </button>
                <div class="pay__radio2">
                  <div class="order-pay__icon2">
                    <div class="icon-visa">
                      <img src="../assets/img/icon/visa.png" alt="" />
                    </div>
                    <div class="icon-mastercard">
                      <img src="../assets/img/icon/mastercard.png" alt="" />
                    </div>
                    <div class="icon-mir">
                      <img src="../assets/img/icon/mir.png" alt="" />
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <modalOk
      v-if="showModal"
      @close="showModal = false"
      v-bind:modal_ok="this.newprod"
    >
    </modalOk>
  </footer>
</template>

<script>
import modalOk from "@/components/modal.vue";
import axios from "axios";
import {
  required,
  maxLength,
  minLength,
  email
} from "vuelidate/lib/validators";
export default {
  name: "footer",
  data() {
    return {
      namefooter: "",
      phonefooter: "",
      newprod: [],
      showModal: false
    };
  },

  validations: {
    namefooter: {
      required,
      maxLength: maxLength(30),
      alpha: val =>
        /^[а-яА-ЯёЁa-zA-Z]|([а-яА-ЯёЁa-zA-Z]+(?: |, |-)+[а-яА-ЯёЁa-zA-Z])$/i.test(
          val
        )
    },
    phonefooter: {
      required
    }
  },
  components: {
    modalOk
  },
  methods: {
    index() {
      this.$router.push("/");
    },
    setName(value) {
      this.namefooter = value;
      // this.$v.namefooter.$touch();
    },
    setPhone(value) {
      this.phonefooter = value;
      // this.$v.phonefooter.$touch();
    },

    postPosts() {
      this.$v.namefooter.$touch();
      this.$v.phonefooter.$touch();
      const forms = document.forms;
      const formData = new FormData(forms[0]);
      this.newprod = [];
      for (const [name, value] of formData) {
        this.newprod = { ...this.newprod, [name]: value };
      }

      if (this.$v.$invalid) {
      } else {
        try {
          const data = axios.post("https://xfence.ru/api/contacts", {
            name: this.newprod.namefooter,
            phone: this.newprod.phonefooter
          });
          this.showModal = true;
          this.newprod = [];
          this.namefooter = "";
          this.phonefooter = "";
          document.getElementById("myForm").reset();
          this.$v.namefooter.$dirty = false;
          this.$v.phonefooter.$dirty = false;

          if (data.status == "success") {
            console.log("Data deliveried");
          } else {
            throw new Error(data.status);
          }
        } catch (e) {
          this.error = e;
        }
        // console.log($v.name.$model);
        // return axios
        //   .post("https://cb0e897ca6ee.ngrok.io/api/contacts", {
        //     body: {
        //       name: this.newprod.name,
        //       phone: this.newprod.phone,
        //     },
        //     headers: {
        //       "Content-Type": "application/json",
        //     },
        //   })
        //   .then((response) => {
        //     this.resp = response;
        //   })
        //   .catch((error) => {
        //     console.log(error);
        //     return error;
        //   });
      }
    }
  }
};
</script>
